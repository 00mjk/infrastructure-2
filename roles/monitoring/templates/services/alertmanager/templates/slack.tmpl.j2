{# title template #}
{%- set __title -%}
{%- raw %}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }}
{%- endraw %}
{%- endset -%}

{# text template #}
{%- set __text -%}
{%- raw %}
{{ range $i, $e := .Alerts -}}
{{ if $i }}———{{ end }}
*{{ .Annotations.title }}*{{ if .Labels.severity }} - `{{ .Labels.severity }}`{{ end }}

{{ if and (eq .Status "resolved") .Annotations.resolved -}}
*Resolved*
{{ .Annotations.resolved }}
{{- else -}}
*Description*
{{ .Annotations.description }}
{{- end }}

{{ if not .Annotations.minimal -}}
*Labels*
{{- range .Labels.SortedPairs }}
• {{ .Name }}: `{{ .Value }}`
{{- end }}
{{- end }}
{{ end }}
{%- endraw -%}
{%- endset -%}

{# color template #}
{%- set __color -%}
{%- raw %}
{{- if eq .Status "firing" -}}
danger
{{- else -}}
good
{{- end -}}
{%- endraw -%}
{%- endset -%}

{# render templates #}
{{ '{{ define "slack.iske.title" }}' }}{{- __title }}{{ '{{ end }}' }}
{{ '{{ define "slack.iske.text" }}' }}{{- __text }}{{ '{{ end }}' }}
{{ '{{ define "slack.iske.color" }}' }}{{- __color }}{{ '{{ end }}' }}
